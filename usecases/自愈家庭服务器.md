# 自愈家庭服务器与基础设施管理

运行家庭服务器意味着你要24/7为自己的基础设施待命。服务在凌晨3点宕机，证书无声过期，磁盘填满，pod崩溃循环——而你正在睡觉或外出。

这个用例将OpenClaw变成一个持久的基础设施代理，具有SSH访问权限、自动化cron作业，以及在你知道问题之前检测、诊断和修复问题的能力。

## 痛点

家庭实验室运营商和自托管者面临持续的维护负担：

- 健康检查、日志监控和警报需要手动设置和关注
- 当出现问题时，你必须SSH进去、诊断和修复——通常是用手机
- 基础设施即代码(Terraform、Ansible、Kubernetes清单)需要定期更新
- 关于你设置的知识存在于你的脑海中，而不是可搜索的文档中
- 常规任务(电子邮件分类、部署检查、安全审计)每周占用数小时

## 功能介绍

- **自动健康监控**：基于cron的服务、部署和系统资源检查
- **自愈**：通过健康检查检测问题并自主应用修复(重启pod、扩展资源、修复配置)
- **基础设施管理**：编写和应用Terraform、Ansible和Kubernetes清单
- **早间简报**：系统健康、日历、天气和任务板状态的每日摘要
- **电子邮件分类**：扫描收件箱，标记可操作项，归档噪音
- **知识提取**：处理笔记和对话导出到结构化、可搜索的知识库
- **博客发布流水线**：草稿→生成横幅→发布到CMS→部署到托管——完全自动化
- **安全审计**：定期扫描硬编码秘密、特权容器和过于宽松的访问权限

## 所需技能

- 对家庭网络机器的`ssh`访问权限
- `kubectl`用于Kubernetes集群管理
- `terraform`和`ansible`用于基础设施即代码
- `1password` CLI用于秘密管理
- `gog` CLI用于电子邮件访问
- 日历API访问权限
- Obsidian vault或notes目录(用于知识库)
- `openclaw doctor`用于自我诊断

## 设置方法

### 1. 核心代理配置

为你的代理命名并在AGENTS.md中定义其访问范围：

```text
## 基础设施代理

你是Reef，基础设施管理代理。

访问权限：
- SSH到家庭网络上的所有机器(192.168.1.0/24)
- K3s集群的kubectl
- 1Password vault(只读访问凭证，专用AI vault)
- 通过gog CLI访问Gmail
- 日历(你的+伴侣的)
- ~/Documents/Obsidian/的Obsidian vault

规则：
- 永远不要硬编码秘密——始终使用1Password CLI或环境变量
- 永远不要直接推送到main——始终创建PR
- 在自我健康检查中运行`openclaw doctor`
- 将所有基础设施更改记录到~/logs/infra-changes.md
```

### 2. 自动化Cron作业系统

这个设置的强大之处在于计划作业系统。在HEARTBEAT.md中配置：

```text
## Cron计划

每15分钟：
- 检查看板上的进行中任务→继续工作

每小时：
- 监控健康检查(Gatus、ArgoCD、服务端点)
- 分类Gmail(标记可操作项，归档噪音)
- 检查未回复的警报或通知

每6小时：
- 知识库数据录入(处理新的Obsidian笔记)
- 自我健康检查(openclaw doctor、磁盘使用情况、内存、日志)

每12小时：
- 代码质量和文档审计
- 通过Loki/监控堆栈进行日志分析

每日：
- 4:00 AM：夜间头脑风暴(探索笔记之间的联系)
- 8:00 AM：早间简报(天气、日历、系统统计、任务板)
- 1:00 AM：速度评估(流程改进)

每周：
- 知识库QA审查
- 基础设施安全审计
```

### 3. 安全设置(关键)

这是必不可少的。在给你的代理SSH访问权限之前：

```text
## 安全清单

1. 预推送钩子：
   - 在所有仓库上安装TruffleHog或类似的秘密扫描器
   - 阻止任何包含硬编码API密钥、令牌或密码的提交

2. 本地优先Git工作流：
   - 使用Gitea(自托管)存储私有代码，然后再推送到公共GitHub
   - CI扫描流水线(Woodpecker或类似)在任何公共推送之前运行
   - 主分支合并需要人工审查

3. 深度防御：
   - 为AI代理创建专用的1Password vault(范围有限)
   - 敏感服务的网络分段
   - 每日自动安全审计，检查：
     * 特权容器
     * 代码或配置中的硬编码秘密
     * 过于宽松的文件/网络访问
     * 已部署镜像中的已知漏洞

4. 代理约束：
   - 分支保护：主分支需要PR，代理无法覆盖
   - 在不需要写入的地方使用只读访问
   - 所有更改都记录在git中，可审计
```

### 4. 早间简报模板

```text
## 每日简报格式

在8:00 AM生成并发送：

### 天气
- [你的位置]的当前状况和预报

### 日历
- 你今天的活动
- 伴侣今天的活动
- 标记冲突或重叠

### 系统健康
- 所有机器的CPU/RAM/存储
- 服务：UP/DOWN状态
- 最近的部署(ArgoCD)
- 过去24小时的任何警报

### 任务板
- 昨天完成的卡片
- 进行中的卡片
- 需要关注的阻塞项

### 亮点
- 夜间头脑风暴中的值得注意的项目
- 需要行动的电子邮件
- 本周即将到来的截止日期
```

## 关键见解

- **"我不敢相信我现在有了一个自愈服务器"**：代理可以运行SSH、Terraform、Ansible和kubectl命令来修复基础设施问题，甚至在你知道问题之前
- **AI会硬编码秘密**：这是#1安全风险。如果你不实施护栏，代理会愉快地将API密钥直接放在代码中。预推送钩子和秘密扫描是强制性的
- **本地优先Git至关重要**：永远不要让代理直接推送到公共仓库。使用私有Gitea实例作为带有CI扫描的暂存区
- **Cron作业是真正的产品**：计划自动化(健康检查、电子邮件分类、简报)比临时命令提供更多日常价值
- **知识提取会复合**：将笔记、对话导出和电子邮件处理成结构化知识库会随着时间的推移变得更有价值——一位用户仅从他们的ChatGPT历史中提取了49,079个原子事实

## 灵感来源

这个用例基于Nathan的详细文章["我用OpenClaw做的所有事情(到目前为止)"](https://madebynathan.com/2026/02/03/everything-ive-done-with-openclaw-so-far/)，他描述了他的OpenClaw代理"Reef"在家庭服务器上运行，具有对所有机器的SSH访问权限、Kubernetes集群、1Password集成，以及包含5,000+笔记的Obsidian vault。Reef运行15个活动cron作业、24个自定义脚本，并自主构建和部署了包括任务管理UI在内的应用程序。Nathan在第一天API密钥暴露后得到的来之不易的教训："AI助手会愉快地硬编码秘密。它们有时没有人类一样的本能。"他的深度防御安全设置(TruffleHog预推送钩子、本地Gitea、CI扫描、每日审计)对于任何尝试这种模式的人都是必不可少的阅读材料。

也在[OpenClaw Showcase](https://openclaw.ai/showcase)上被引用，`@georgedagg_`描述了类似的模式：部署监控、日志审查、配置修复和PR提交——所有这些都在遛狗时完成。

## 相关链接

- [Nathan的完整文章](https://madebynathan.com/2026/02/03/everything-ive-done-with-openclaw-so-far/)
- [OpenClaw文档](https://github.com/openclaw/openclaw)
- [TruffleHog(秘密扫描)](https://github.com/trufflesecurity/trufflehog)
- [K3s(轻量级Kubernetes)](https://k3s.io/)
- [Gitea(自托管Git)](https://gitea.io/)
- [n8n(工作流自动化)](https://n8n.io/)